/*! For license information please see worker-controller.worker.js.LICENSE.txt */
!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6097)}({103:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=t.Controller=t.ProcessBase=void 0;var i=n(104);Object.defineProperty(t,"ProcessBase",{enumerable:!0,get:function(){return i.ProcessBase}});var s=n(105);Object.defineProperty(t,"Controller",{enumerable:!0,get:function(){return s.Controller}});var r=n(107);Object.defineProperty(t,"Runner",{enumerable:!0,get:function(){return r.Runner}})},104:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ProcessBase=void 0;const s=n(67);t.ProcessBase=class{init(e){return i(this,void 0,void 0,(function*(){}))}get sleep(){return s.DEFAULT_SLEEP}get minimumStep(){return s.DEFAULT_MINIMUM_STEP}}},105:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Controller=void 0;const i=n(68);t.Controller=class{constructor(e,t){var n,s,r,o;this._listener=e,this.worker=new Worker(null!==(n=null==t?void 0:t.workerName)&&void 0!==n?n:"worker-controller.worker.js"),this.worker.addEventListener("message",e=>{this.getListener()(i.deserialize(e.data))}),this.worker.postMessage(["init",null!==(s=null==t?void 0:t.path)&&void 0!==s?s:"process.js",null!==(r=null==t?void 0:t.className)&&void 0!==r?r:"Process",JSON.stringify(null!==(o=null==t?void 0:t.context)&&void 0!==o?o:{})])}getListener(){return this._listener}reset(e){this.worker.postMessage(["reset",JSON.stringify(null!=e?e:{})])}start(){this.worker.postMessage(["start"])}stop(){this.getListener()({status:"canceling"}),this.worker.postMessage(["stop"])}}},106:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deserialize=t.serializeStatus=t.serializeProcess=void 0,t.serializeProcess=e=>i(void 0,void 0,void 0,(function*(){return JSON.stringify({type:"update",data:yield e.getObject()})})),t.serializeStatus=e=>JSON.stringify({type:"status",data:{status:e}}),t.deserialize=e=>{const t=JSON.parse(e);return t.type,t.data}},107:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;const s=n(68),r=n(67);t.Runner=class{constructor(e){this.onPostMessage=e,this.onCancel=!1,this.isRunning=!1}setProcess(e){this.process=e}getOnUpdateCallback(){return()=>this.onUpdated()}onUpdated(){return i(this,void 0,void 0,(function*(){this.process&&this.onPostMessage(yield s.serializeProcess(this.process))}))}onStatusChanged(e){return i(this,void 0,void 0,(function*(){this.onPostMessage(s.serializeStatus(e))}))}sleep(e){return i(this,void 0,void 0,(function*(){return new Promise(t=>setTimeout(t,e))}))}reset(e){return i(this,void 0,void 0,(function*(){if(!this.onCancel&&this.process){for(this.onCancel=!0,yield this.onStatusChanged("canceling");this.isRunning;)yield this.sleep(r.CANCEL_SLEEP);yield this.process.reset(e),this.onCancel=!1,yield this.onUpdated(),yield this.onStatusChanged("initialized")}}))}start(){return i(this,void 0,void 0,(function*(){if(this.isRunning||this.onCancel||!this.process)return;this.isRunning=!0,yield this.onStatusChanged("started");let e=this.process.progress;for(;!this.process.isFinished&&!this.onCancel;)yield this.process.step(),yield this.sleep(this.process.sleep),this.process.progress>e+this.process.minimumStep&&(e=this.process.progress,yield this.onUpdated());yield this.onUpdated(),this.process.isFinished?yield this.onStatusChanged("finished"):yield this.onStatusChanged("canceled"),this.onCancel=!1,this.isRunning=!1}))}stop(){return i(this,void 0,void 0,(function*(){!this.onCancel&&this.isRunning&&this.process&&(this.onCancel=!0)}))}}},43:function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},6097:function(e,t,n){"use strict";(function(e){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(103);let r;self.addEventListener("message",t=>i(void 0,void 0,void 0,(function*(){var n,i,o;switch(t.data[0]){case"init":{importScripts(t.data[1]),r=new s.Runner(e=>{self.postMessage(e)});const o=JSON.parse(null!==(n=t.data[3])&&void 0!==n?n:{}),a=new e[null!==(i=t.data[2])&&void 0!==i?i:"Process"](r.getOnUpdateCallback(),o);yield a.init(o),r.setProcess(a),yield r.reset(void 0);break}case"reset":r&&(yield r.reset(JSON.parse(null!==(o=t.data[1])&&void 0!==o?o:{})));break;case"start":r&&(yield r.start());break;case"stop":r&&(yield r.stop())}})))}).call(this,n(43))},67:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MINIMUM_STEP=t.DEFAULT_SLEEP=t.CANCEL_SLEEP=void 0,t.CANCEL_SLEEP=100,t.DEFAULT_SLEEP=10,t.DEFAULT_MINIMUM_STEP=.01},68:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(106),t)}});